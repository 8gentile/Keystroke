<html>
<head>
  <meta charset="UTF-8">
  <title>Keystroke</title>
  <style>
    canvas {
      border: 5px solid black;
    }
  </style>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      let handle = null;
      var x = 20;
      var y = 295 ;
      var iy = -20 // angle
      var vx = 7 ; // power max(15?)
      var vy = iy;
      var g = 1;

      canvas.width = 600;
      canvas.height = 300;

      const ballRadius = 5;

      const gravityCalc = (n) => {
        return n + g;
      }

      const drawHUD = () => {
        const lx = x + 5;
        const ly = y - 5;
        ctx.beginPath();
        ctx.moveTo(lx, ly);
        ctx.lineTo(lx + vx, ly + iy);
        ctx.stroke();
      }

      const drawBall = () => {
        ctx.beginPath();
        ctx.arc(x, y, ballRadius, 0, Math.PI*2);
        ctx.fillStyle = "#0095DD";
        ctx.fill();
        ctx.closePath();
      }

      const collision = () => {
        console.log(vx, vy, iy)
        if (y >= 294) {
          iy /= 2;
          vy = iy;
          vx /= 1.3;
          if (Math.abs(vx) < 1) {
            console.log("I'm resting tho");
            clearInterval(handle);
            iy = -20;
            vx = 7;
            vy = iy;
            return drawRest();
          }
        }
      }

      const drawCollision = () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawBall();
        x += vx;
        y += vy;
        vy = gravityCalc(vy);
        collision(x, y);
      }

      const drawRest = () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawBall();
        drawHUD();
      }

      const doKeyDown = (e) => {
        switch(e.keyCode){
          case 32:
            return handle = setInterval(drawCollision, 30);
          case 97:
            if (Math.sign(vx) === 1) {
              vx = -1 * vx;
            }
            console.log(vx);
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            return drawRest();
          case 100:
            if (Math.sign(vx) === -1) {
              vx = -1 * vx;
            }
            console.log(vx);
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            return drawRest();
          case 115:
            vy += 1;
            iy += 1;
            console.log(vy);
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            return drawRest();
          case 119:
            vy -= 1;
            iy -= 1;
            console.log(vy);
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            return drawRest();
          default:
            return null;
        }
      }

      drawRest();
      window.addEventListener("keypress", doKeyDown, false);
    })
  </script>
</head>
<body>
  <canvas id="canvas"></canvas>
</body>
</html>